## Codebase Patterns
- Settings use `tauri-plugin-store` (JSON file), not SQLite. Add new fields by: adding store key const, load block in `load_settings()`, set call in `save_settings()`, field in `AppSettings` struct + Default impl.
- New command files in `src-tauri/src/commands/` need 3 registrations: pub mod + pub use in `mod.rs`, import + generate_handler! in `lib.rs`.
- Use `pub(crate)` visibility for helper functions shared between command modules (e.g., `load_settings`, `save_settings`, `settings_cache`).
- `#[serde(rename_all = "camelCase")]` on all DTOs sent to frontend.
- `AppError` has convenience constructors like `invalid_input_field()`, `not_found_with_id()`, etc.
- Companion server service: `services::companion_server` has `start_companion_server()`, `stop_companion_server()`, `is_companion_server_running()`.
- Frontend dist path: In dev mode, `CARGO_MANIFEST_DIR/../dist`; in prod, Tauri resource dir. Both checked via `index.html` existence.
- Transport layer: `src/services/transport.ts` detects Tauri vs browser via `window.__TAURI_INTERNALS__`. `tauri.ts` uses `transportInvoke` instead of direct `@tauri-apps/api` invoke. `isTauri` exported from `services/index.ts`.
- All `@tauri-apps/` imports should be dynamic — any new feature using Tauri APIs must follow this pattern.
- `tauriListen()` and `openExternalUrl()` in `transport.ts` handle Tauri vs browser seamlessly.
- Package manager: bun (not npm/yarn). Typecheck: `bunx tsc --noEmit`.

- When replacing `dangerouslySetInnerHTML` with SVG content, use `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}` as an `<img>` src — avoids XSS while preserving visual output.

---

## 2026-02-18 - US-001
- Replaced `dangerouslySetInnerHTML={{ __html: qrSvg }}` with safe `<img>` element using data URI
- Changed `<div>` to `<img>` with `alt` text for accessibility
- Updated CSS: removed `display: flex`, child `svg` selector (no longer needed with `<img>`), added `box-sizing: content-box`
- Files changed: `src/pages/Settings.tsx`, `src/pages/Settings.css`
- **Learnings for future iterations:**
  - QR SVG is generated by Rust backend via `getCompanionQrSvg()` — it's trusted content, but `dangerouslySetInnerHTML` is still an anti-pattern
  - CSS had `.companion-qr-code svg` child selector that targeted inline SVG — switching to `<img>` requires removing those child selectors
  - Data URI approach: `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svgString)}` works well for trusted SVG rendering
---

