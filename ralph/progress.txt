## Codebase Patterns
- SyncEngine::new() requires (DbPool, AppHandle) - AppHandle needed for event emission
- SyncEngine::start_background() requires (DbPool, SyncConfig, AppHandle)
- get_sync_status command creates ephemeral SyncEngine just for log queries - must pass AppHandle
- `use tauri::Emitter` is needed wherever `app_handle.emit()` is called
- sync_events.rs defines all event constants and payload structs - use those, don't create new ones
- Event emission failures should be logged but never abort sync (use `let _ = app_handle.emit(...)` or log on Err)

---

## 2026-02-09 - US-001
- What was implemented: Added AppHandle field to SyncEngine struct and threaded it through start_background() and lib.rs setup
- Files changed:
  - `src-tauri/src/services/sync_engine.rs`: Added `app_handle: tauri::AppHandle` field to SyncEngine, updated `new()` and `start_background()` signatures, added `use tauri::Emitter`
  - `src-tauri/src/lib.rs`: Pass `app.handle().clone()` to `SyncEngine::start_background()`
  - `src-tauri/src/commands/sync.rs`: Updated `get_sync_status` to accept `AppHandle` and pass it to `SyncEngine::new()`
- **Learnings for future iterations:**
  - `app.handle().clone()` in Tauri v2 setup closure gives you the AppHandle
  - `get_sync_status` command creates a temporary SyncEngine just for DB log queries - it needs AppHandle too
  - Warnings about unused `app_handle` and `Emitter` are expected until US-002 starts using them
---

## 2026-02-09 - US-002
- What was implemented: Added sync-progress event emissions throughout run_sync flow
- Files changed:
  - `src-tauri/src/services/sync_engine.rs`: Added emit_progress() helper, imported SyncProgressPayload/SyncPhase/SYNC_PROGRESS_EVENT. Emit events for: starting, fetching_mrs (per instance with URL), fetching_diff (per MR), fetching_comments (per MR), pushing_actions, purging, complete (with MR count and duration), failed (with error message)
- **Learnings for future iterations:**
  - emit_progress() helper keeps emit calls concise - just pass phase + message
  - Complete/failed events need special handling (processed/total/is_error fields) so they use direct emit calls
  - All event emissions use log::warn on failure, never abort sync
---
