{
  "project": "Ultra GitLab",
  "branchName": "ralph/local-mr-review",
  "description": "Local-first GitLab MR review tool with background sync, keyboard shortcuts, and tree-sitter syntax highlighting",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add GitLab instance configuration schema",
      "description": "As a developer, I need to store GitLab instance configuration in local storage.",
      "acceptanceCriteria": [
        "Create TypeScript types for GitLabInstance (url, name, token)",
        "Create Rust struct for GitLabInstance in Tauri backend",
        "Implement secure token storage using tauri-plugin-store or OS keychain",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Add MergeRequest and related data types",
      "description": "As a developer, I need TypeScript and Rust types for MR data structures.",
      "acceptanceCriteria": [
        "Create MergeRequest type with metadata (id, iid, title, author, status, source/target branches, labels, reviewers)",
        "Create Diff type with file paths, change type, line content",
        "Create Comment type with author, content, line reference, resolution status",
        "Create SyncAction type for queued operations (approval, comment, reply)",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Implement local SQLite storage for MR data",
      "description": "As a developer, I need persistent local storage for MR data using SQLite.",
      "acceptanceCriteria": [
        "Add rusqlite or sqlx dependency to Cargo.toml",
        "Create SQLite schema for merge_requests, diffs, comments, sync_actions tables",
        "Implement database initialization on app startup",
        "Store database in app data directory",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create GitLab API client in Rust",
      "description": "As a developer, I need a Rust client for GitLab API v4.",
      "acceptanceCriteria": [
        "Add reqwest dependency for HTTP requests",
        "Implement authenticated GET requests to GitLab API",
        "Create function to fetch MRs where user is author or assigned reviewer",
        "Handle API pagination",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Implement MR diff fetching from GitLab API",
      "description": "As a developer, I need to fetch complete diff content for each MR.",
      "acceptanceCriteria": [
        "Implement function to fetch MR diff via GitLab API",
        "Parse diff response into structured Diff objects",
        "Store diffs in local SQLite database",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement comments fetching from GitLab API",
      "description": "As a developer, I need to fetch all comments and discussions for each MR.",
      "acceptanceCriteria": [
        "Implement function to fetch MR discussions via GitLab API",
        "Parse discussions into Comment objects with thread structure",
        "Store comments in local SQLite database with line references",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Create Tauri commands for MR data access",
      "description": "As a frontend developer, I need Tauri IPC commands to access MR data from React.",
      "acceptanceCriteria": [
        "Create get_merge_requests command returning all cached MRs",
        "Create get_merge_request command returning single MR with diffs and comments",
        "Commands read from local SQLite only (no network)",
        "Return data within 100ms for cached content",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Build MR list React component",
      "description": "As a user, I want to see a list of all cached merge requests.",
      "acceptanceCriteria": [
        "Create MRList component displaying MRs with title, author, status",
        "Show MR metadata: source/target branches, labels, reviewer avatars",
        "MR list loads from Tauri command on mount",
        "Display 'Not yet synced' placeholder if no cached data",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Add keyboard navigation to MR list",
      "description": "As a power user, I want to navigate the MR list using j/k keys.",
      "acceptanceCriteria": [
        "j key moves selection down, k key moves selection up",
        "Enter key opens selected MR",
        "Selection wraps at list boundaries",
        "Visual highlight shows current selection",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Build diff view React component",
      "description": "As a user, I want to view MR diffs with file changes.",
      "acceptanceCriteria": [
        "Create DiffView component showing changed files",
        "Display file path and change type (added/modified/deleted)",
        "Show line-by-line diff content with +/- indicators",
        "Support unified diff view layout",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Add tree-sitter syntax highlighting to diff view",
      "description": "As a user, I want code in diffs to be syntax highlighted.",
      "acceptanceCriteria": [
        "Integrate tree-sitter WASM grammars for syntax highlighting",
        "Detect language from file extension",
        "Apply syntax highlighting to diff content",
        "Support at least: JavaScript, TypeScript, Python, Rust, Go, Java",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Add file navigation within diff view",
      "description": "As a user, I want to navigate between changed files in an MR.",
      "acceptanceCriteria": [
        "Show file list sidebar or header in diff view",
        "Clicking file name scrolls to that file's diff",
        "Keyboard shortcuts [ and ] move between files",
        "Current file highlighted in file list",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Add collapse/expand for unchanged code regions",
      "description": "As a user, I want to collapse unchanged code to focus on changes.",
      "acceptanceCriteria": [
        "Unchanged code regions collapsed by default (showing '... N lines hidden')",
        "Click to expand hidden regions",
        "Keyboard shortcut 'e' expands all regions in current file",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Display inline comments in diff view",
      "description": "As a user, I want to see existing comments at their line positions.",
      "acceptanceCriteria": [
        "Comments displayed below their referenced line in diff",
        "Show comment author, timestamp, content",
        "Show reply thread if multiple replies exist",
        "Visual indicator for resolved vs unresolved threads",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Implement sync queue for local actions",
      "description": "As a developer, I need a queue system for pending sync actions.",
      "acceptanceCriteria": [
        "SyncAction stored in SQLite with type, payload, status, retry_count",
        "Queue persists across app restarts",
        "Actions processed in order (FIFO)",
        "Tauri command to add action to queue",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Implement MR approval action",
      "description": "As a reviewer, I want to approve an MR with immediate UI feedback.",
      "acceptanceCriteria": [
        "Approve button/shortcut (Shift+A) in MR view",
        "UI immediately shows 'Approved' status (optimistic update)",
        "Approval action added to sync queue",
        "Local MR state updated to show user's approval",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "Implement inline comment creation",
      "description": "As a reviewer, I want to add inline comments on specific lines.",
      "acceptanceCriteria": [
        "Press 'c' on a diff line to open comment input",
        "Submit comment with Cmd+Enter",
        "Comment appears immediately in diff view (optimistic update)",
        "Comment action added to sync queue",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 17,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Implement comment reply functionality",
      "description": "As a reviewer, I want to reply to existing comment threads.",
      "acceptanceCriteria": [
        "Reply button on existing comments",
        "Press 'r' when comment is focused to reply",
        "Reply appears in thread immediately (optimistic update)",
        "Reply action added to sync queue",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "Implement thread resolve/unresolve",
      "description": "As a reviewer, I want to resolve and unresolve discussion threads.",
      "acceptanceCriteria": [
        "Resolve button on unresolved threads",
        "Unresolve button on resolved threads",
        "UI updates immediately (optimistic update)",
        "Resolve/unresolve action added to sync queue",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Implement background sync queue processor",
      "description": "As a developer, I need the sync queue to process when network is available.",
      "acceptanceCriteria": [
        "Background task checks queue every 30 seconds",
        "Process actions in FIFO order",
        "POST/PUT to GitLab API for each action type",
        "Mark action as synced on success",
        "Increment retry_count on failure",
        "Typecheck passes"
      ],
      "priority": 20,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "Show pending sync status in UI",
      "description": "As a user, I want to see which actions are pending sync.",
      "acceptanceCriteria": [
        "Pending comments show 'syncing' indicator",
        "Failed sync shows error icon with retry option",
        "Synced actions remove pending indicator",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 21,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-022",
      "title": "Implement background MR sync fetcher",
      "description": "As a user, I want new MRs fetched automatically in background.",
      "acceptanceCriteria": [
        "Background task fetches MRs at configurable interval (default 5 min)",
        "Fetch MRs where user is author or assigned reviewer",
        "Fetch diffs and comments for each new/updated MR",
        "Store in local SQLite database",
        "Typecheck passes"
      ],
      "priority": 22,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-023",
      "title": "Add sync status bar to UI",
      "description": "As a user, I want to see sync status in a status bar.",
      "acceptanceCriteria": [
        "Status bar shows last sync time",
        "Status bar shows 'Syncing...' during sync",
        "Status bar shows error count if sync failed",
        "Expandable to show last 50 operations",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 23,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-024",
      "title": "Add manual sync trigger",
      "description": "As a user, I want to manually trigger a sync.",
      "acceptanceCriteria": [
        "Sync button in status bar",
        "Keyboard shortcut Cmd+R triggers sync",
        "Button disabled during active sync",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 24,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-025",
      "title": "Add new MR notification",
      "description": "As a user, I want to be notified when new MRs are synced.",
      "acceptanceCriteria": [
        "Non-intrusive notification shows count of new/updated MRs",
        "Notification does not interrupt current work",
        "Click notification to view new MRs",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 25,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-026",
      "title": "Implement MR data purge on close/merge",
      "description": "As a developer, I need closed/merged MRs purged from local storage.",
      "acceptanceCriteria": [
        "During sync, detect MRs that are now merged or closed",
        "Delete MR data, diffs, and comments from SQLite",
        "Delete pending sync actions for closed MRs",
        "Typecheck passes"
      ],
      "priority": 26,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-027",
      "title": "Add command palette",
      "description": "As a power user, I want a command palette for action discovery.",
      "acceptanceCriteria": [
        "Cmd+P opens command palette",
        "Search/filter available commands",
        "Execute command on selection",
        "Show keyboard shortcut next to each command",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 27,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-028",
      "title": "Add keyboard shortcuts help overlay",
      "description": "As a user, I want to see all available keyboard shortcuts.",
      "acceptanceCriteria": [
        "Press '?' to show shortcuts overlay",
        "Group shortcuts by context (list, diff, global)",
        "Press Escape to close overlay",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 28,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-029",
      "title": "Add keyboard shortcut customization",
      "description": "As a power user, I want to customize keyboard shortcuts.",
      "acceptanceCriteria": [
        "Settings page for keyboard shortcuts",
        "Click shortcut to rebind",
        "Save custom shortcuts to local storage",
        "Reset to defaults option",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 29,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030",
      "title": "Add side-by-side diff view",
      "description": "As a user, I want to toggle between unified and side-by-side diff views.",
      "acceptanceCriteria": [
        "Toggle button to switch between unified and side-by-side",
        "Keyboard shortcut 'd' toggles diff view mode",
        "Side-by-side shows old/new code in parallel columns",
        "Preference persists in local storage",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 30,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-031",
      "title": "Add GitLab instance configuration UI",
      "description": "As a user, I want to configure GitLab instance and token in settings.",
      "acceptanceCriteria": [
        "Settings page with form for GitLab URL and token",
        "Support multiple instances",
        "Test connection button",
        "Token stored securely",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 31,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-032",
      "title": "Handle authentication expiry",
      "description": "As a user, I want to be prompted when my GitLab token expires.",
      "acceptanceCriteria": [
        "Detect 401 responses from GitLab API",
        "Show re-authentication prompt",
        "Preserve pending local changes during re-auth",
        "Resume sync after successful re-auth",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 32,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-033",
      "title": "Add disk space warning",
      "description": "As a user, I want to be warned when cache approaches disk limit.",
      "acceptanceCriteria": [
        "Configurable cache size limit (default 1GB)",
        "Warning when 80% of limit reached",
        "Offer to prune oldest MR data",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 33,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-034",
      "title": "Handle large diffs with progressive loading",
      "description": "As a user, I want large diffs to load progressively.",
      "acceptanceCriteria": [
        "Diffs >10,000 lines load visible portion first",
        "Scroll triggers loading of additional content",
        "Show total line count and loaded percentage",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 34,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-035",
      "title": "Handle sync conflicts gracefully",
      "description": "As a user, I want to be notified when my local actions conflict with server state.",
      "acceptanceCriteria": [
        "Detect when MR is merged/closed during pending actions",
        "Show notification of stale actions",
        "Auto-discard conflicting actions (comment on deleted line)",
        "Typecheck passes",
        "Verify in browser using dev server"
      ],
      "priority": 35,
      "passes": false,
      "notes": ""
    }
  ]
}
