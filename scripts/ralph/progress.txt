# Ralph Progress Log
Started: Fri Feb 13 15:37:35 CET 2026

## Codebase Patterns
- All CSS color variables are now applied dynamically by ThemeProvider (no more hardcoded values in App.css :root)
- ThemeProvider is in src/components/ThemeProvider.tsx, useTheme hook in src/hooks/useTheme.ts
- ThemeProvider uses React 19 context (`<ThemeContext value=...>` not the old Provider pattern)
- ThemeProvider maps ThemeDefinition → CSS variables via `themeToCssVars()` function
- Extra syntax vars (--syntax-string-special, --syntax-embedded-bg) are derived from ThemeDefinition fields (attribute, accent.bg)
- New unique variables: --bg-dim, --bg-winter, --text-fuji, --accent-pink/green/crystal/warm-yellow/ronin/orange/peach, --wave-glow, --wave-glow-strong
- Monaco theme is dynamically generated from ThemeDefinition via src/themes/monacoAdapter.ts (themeToMonacoTheme)
- MonacoProvider registers the theme as "ultra-active-theme" via MONACO_THEME_NAME constant
- Old hardcoded kanagawaTheme.ts was deleted — all Monaco colors now come from the active ThemeDefinition
- Tree-sitter syntax highlighting uses --syntax-* CSS variables in src/styles/syntax.css with .hl-{token} classes
- Syntax CSS variables: --syntax-keyword, --syntax-string, --syntax-string-special, --syntax-comment, --syntax-function, --syntax-type, --syntax-variable, --syntax-number, --syntax-operator, --syntax-punctuation, --syntax-tag, --syntax-attribute, --syntax-constant, --syntax-property, --syntax-embedded-bg
- Settings type in src/types/index.ts, Theme type is currently 'light' | 'dark' | 'system'
- Always use `bunx tsc --noEmit` for typecheck, `bun` as package manager
- PipelinesPage.css mostly uses standard variables already (--bg-primary, --text-primary etc.), not --kw-* pattern

---

## 2026-02-13 - US-001
- Created ThemeDefinition interface in src/themes/types.ts covering all CSS variable groups
- Created Kanagawa Wave theme data in src/themes/kanagawa-wave.ts with values from App.css and MRDetailPage.css
- Created barrel export in src/themes/index.ts
- Files changed: src/themes/types.ts, src/themes/kanagawa-wave.ts, src/themes/index.ts (all new)
- **Learnings for future iterations:**
  - App.css :root has the "standard" CSS variables (--bg-primary, --text-primary, etc.)
  - MRDetailPage.css :root has --kw-* duplicates that map to the same values
  - Monaco kanagawaTheme.ts uses hex without '#' prefix for token foreground colors
  - syntax.css uses different colors than Kanagawa palette (GitHub-style colors), these will need updating
---

## 2026-02-13 - US-002
- Consolidated all --kw-* CSS variables into the unified App.css :root set
- Added new standard variables: --bg-dim, --bg-winter, --text-fuji, --accent-pink, --accent-green, --accent-crystal, --accent-warm-yellow, --accent-ronin, --accent-orange, --accent-peach, --wave-glow, --wave-glow-strong
- Replaced all --kw-* usages across 6 CSS files: MRDetailPage.css, MRListPage.css, Settings.css, MyMRsPage.css, MyMRDetailPage.css, PipelinesPage.css
- Removed duplicate :root blocks from MRDetailPage.css and MRListPage.css
- Removed duplicate @import for Google Fonts from MRDetailPage.css
- Files changed: src/App.css, src/pages/MRDetailPage.css, src/pages/MRListPage.css, src/pages/Settings.css, src/pages/MyMRsPage.css, src/pages/MyMRDetailPage.css, src/pages/PipelinesPage.css
- **Learnings for future iterations:**
  - The --kw-* → standard variable mapping: bg-dark→bg-secondary, bg-default→bg-primary, bg-dim→bg-dim(new), bg-highlight→bg-tertiary, bg-gutter→gutter-bg, fg-default→text-primary, fg-dim→text-secondary, fg-muted→text-tertiary, fg-comment→text-muted, wave-blue→accent-color, wave-cyan→accent-hover, sumi-ink→border-color, fuji-gray→text-fuji(new), autumn-red→error-color, spring-green→success-color, carpYellow→warning-color
  - MyMRsPage.css and MyMRDetailPage.css use fallback syntax: `var(--kw-name, #fallback)` — need to match this pattern in replace
  - PipelinesPage.css had nested fallback: `var(--kw-bg-default, var(--bg-primary))` — simplify to just `var(--bg-primary)`
  - Some CSS files (PipelinesPage.css) used hardcoded hex instead of variables in pseudo-elements — these weren't touched as they match the final values
---

## 2026-02-13 - US-003
- Converted all hardcoded hex colors in src/styles/syntax.css to CSS variables
- Added 15 --syntax-* CSS variable declarations to the :root block in App.css
- Variables: --syntax-keyword, --syntax-string, --syntax-string-special, --syntax-comment, --syntax-function, --syntax-type, --syntax-variable, --syntax-number, --syntax-operator, --syntax-punctuation, --syntax-tag, --syntax-attribute, --syntax-constant, --syntax-property, --syntax-embedded-bg
- Sub-variant classes reuse base variables (e.g., .hl-variable-builtin → --syntax-constant, .hl-label → --syntax-function)
- Files changed: src/App.css, src/styles/syntax.css
- **Learnings for future iterations:**
  - syntax.css uses GitHub-style colors (not Kanagawa palette) — these are the current defaults in ThemeDefinition.syntaxHighlight
  - Sub-variant mappings: string-special→attribute color, escape/constant-builtin/variable-builtin/punctuation-special→constant color, variable-parameter→type color, label/constructor→function color
  - Added --syntax-string-special and --syntax-embedded-bg beyond the base 13 SyntaxHighlightColors fields — future ThemeProvider will need to handle these extra variables
---

## 2026-02-13 - US-004
- Created ThemeProvider component (src/components/ThemeProvider.tsx) with React context
- Created useTheme hook (src/hooks/useTheme.ts) that reads theme from ThemeContext
- ThemeProvider applies all ThemeDefinition values as CSS variables on :root via document.documentElement.style
- Handles all CSS variable groups: backgrounds, text, borders, accent, focus, links, status, diff, labels, card, input, extended palette, syntax highlighting
- Handles extra syntax vars (--syntax-string-special → attribute, --syntax-embedded-bg → accent.bg)
- Removed all hardcoded color values from App.css :root (kept font/layout properties only)
- Mounted ThemeProvider in App.tsx wrapping MonacoProvider > ToastProvider > BrowserRouter
- Kanagawa Wave is the default theme loaded on startup
- Files changed: src/components/ThemeProvider.tsx (new), src/hooks/useTheme.ts (new), src/App.css, src/App.tsx
- **Learnings for future iterations:**
  - React 19 uses `<Context value={}>` directly, not `<Context.Provider value={}>` — use the new pattern
  - The ThemeProvider needs to be the outermost wrapper so all providers/components can access theme
  - --syntax-string-special and --syntax-embedded-bg are not in SyntaxHighlightColors interface but are used by syntax.css — ThemeProvider derives them from related fields
  - The themeToCssVars() mapping function is the single source of truth for ThemeDefinition → CSS variable mapping
---

## 2026-02-13 - US-005
- Created src/themes/monacoAdapter.ts with themeToMonacoTheme() that converts ThemeDefinition → Monaco IStandaloneThemeData
- Updated MonacoProvider to use useTheme() context + adapter instead of hardcoded kanagawaTheme import
- MonacoProvider registers a single "ultra-active-theme" and re-registers it on theme changes via defineTheme + setTheme
- Updated MonacoDiffViewer to use MONACO_THEME_NAME from MonacoProvider instead of KANAGAWA_THEME_NAME
- Updated Monaco/index.ts barrel to export MONACO_THEME_NAME instead of old kanagawa exports
- Deleted src/components/Monaco/kanagawaTheme.ts (replaced by adapter)
- Exported themeToMonacoTheme and getMonacoThemeName from src/themes/index.ts
- Files changed: src/themes/monacoAdapter.ts (new), src/components/Monaco/MonacoProvider.tsx, src/components/Monaco/MonacoDiffViewer.tsx, src/components/Monaco/index.ts, src/components/Monaco/kanagawaTheme.ts (deleted), src/themes/index.ts
- **Learnings for future iterations:**
  - Monaco editor.defineTheme() requires the `base` field to be 'vs-dark' or 'vs' — derive from theme.type
  - Monaco token foreground colors are hex WITHOUT '#' prefix (e.g., 'dcd7ba' not '#dcd7ba')
  - Monaco editor colors (the `colors` record) ARE with '#' prefix
  - MonacoProvider needs a ref to the Monaco instance for theme updates — loader.init() returns it, store in useRef
  - The init effect runs once on mount; a separate effect watches theme changes and re-registers
  - DiffEditor's `theme` prop uses the registered theme name string, not the theme data object
---
