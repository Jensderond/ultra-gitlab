# Ralph Progress Log
Started: Thu Jan 30 2026
Feature: Local-First GitLab MR Review
---

## Codebase Patterns
<!-- Consolidated learnings - check this FIRST before starting work -->

### Architecture
- **Frontend**: React 19, TypeScript, Vite 7 in `src/`
- **Backend**: Tauri 2 (Rust) in `src-tauri/`
- **Package Manager**: Bun

### Conventions
- Use `@tauri-apps/api` `invoke()` for frontend-to-backend IPC
- Use `bun run tauri dev` for full app development
- Use `bun run dev` for frontend-only development

### Gotchas
- `tauri-plugin-store` is used for settings persistence (alternative to custom keyring since tauri-plugin-keyring may not be available for Tauri 2)
- tree-sitter and tree-sitter-highlight versions must match (0.24)
- reqwest uses `rustls-tls` (not native-tls) to avoid OpenSSL dependency issues on macOS

---

## 2026-01-30 - T001
**Workflow**: Speckit
**Feature**: Local-First GitLab MR Review (001-local-mr-review)

### Implemented
- Added all Rust dependencies to src-tauri/Cargo.toml:
  - sqlx 0.8 with runtime-tokio and sqlite features
  - reqwest 0.12 with json and rustls-tls features
  - tree-sitter 0.24 and tree-sitter-highlight 0.24
  - thiserror 2 for error handling
  - tokio 1 with sync and time features
  - chrono 0.4 with serde feature
  - tauri-plugin-store 2 for settings storage

### Files Changed
- src-tauri/Cargo.toml

### Learnings for Future Iterations
- Cargo check passed; all dependencies compatible with Tauri 2.9.5
- 573 packages locked; first build fetches many transitive dependencies

---

## 2026-01-30 - T002
**Workflow**: Speckit
**Feature**: Local-First GitLab MR Review (001-local-mr-review)

### Implemented
- Added frontend dependencies via bun:
  - react-window 2.2.5 for virtual scrolling in diff viewer
  - @tauri-apps/plugin-store 2.4.2 for settings/credential persistence
  - react-router-dom 7.13.0 for page routing
  - @types/react-window for TypeScript support
- Note: tauri-plugin-keyring-api not available for Tauri 2; using plugin-store instead

### Files Changed
- package.json
- bun.lock

### Learnings for Future Iterations
- For Tauri 2, use `@tauri-apps/plugin-store` not keyring for secure storage on frontend
- react-window v2 has native TypeScript support but @types/react-window still recommended

---

## 2026-01-30 - T003
**Workflow**: Speckit
**Feature**: Local-First GitLab MR Review (001-local-mr-review)

### Implemented
- Created comprehensive TypeScript types in src/types/index.ts matching data model entities:
  - GitLabInstance types for instance configuration
  - MergeRequest and related filter/response types
  - Diff types (DiffFile, DiffHunk, DiffLine, HighlightToken)
  - Comment types with sync status tracking
  - SyncAction and SyncLog types
  - Settings and Theme types
  - Tauri event payload types (SyncProgress, MRUpdated, ActionSynced)
  - Error types matching IPC error codes

### Files Changed
- src/types/index.ts (new)

### Learnings for Future Iterations
- Types are organized by entity category with clear section headers
- All types use proper discriminated unions (e.g., MRState, ActionType)
- Optional fields use TypeScript's `| null` pattern to match Rust's Option<T>

---

## 2026-01-30 - T004
**Workflow**: Speckit
**Feature**: Local-First GitLab MR Review (001-local-mr-review)

### Implemented
- Configured Tauri capabilities for store plugin (replacing keyring):
  - Added "store:default" permission to src-tauri/capabilities/default.json
  - Registered tauri_plugin_store in src-tauri/src/lib.rs
- Note: Task originally specified keyring.json but using store plugin instead

### Files Changed
- src-tauri/capabilities/default.json
- src-tauri/src/lib.rs

### Learnings for Future Iterations
- Tauri 2 plugins require both: capability permissions AND plugin registration in lib.rs
- Store plugin uses `tauri_plugin_store::Builder::new().build()` pattern

---

## 2026-01-30 - T005
**Workflow**: Speckit
**Feature**: Local-First GitLab MR Review (001-local-mr-review)

### Implemented
- Created Rust module structure with mod.rs files:
  - src-tauri/src/commands/mod.rs - IPC command handlers
  - src-tauri/src/models/mod.rs - Data models for SQLite and IPC
  - src-tauri/src/services/mod.rs - Business logic services
  - src-tauri/src/db/mod.rs - Database layer with get_db_path helper
- Registered all modules in lib.rs with doc comments

### Files Changed
- src-tauri/src/lib.rs
- src-tauri/src/commands/mod.rs (new)
- src-tauri/src/models/mod.rs (new)
- src-tauri/src/services/mod.rs (new)
- src-tauri/src/db/mod.rs (new)

### Learnings for Future Iterations
- Each mod.rs includes commented placeholders for submodules to be added later
- db/mod.rs includes get_db_path helper for consistent database location

---

