# Ralph Progress Log
Started: Sat Feb 28 14:18:43 CET 2026
---

## Codebase Patterns
- Frontend hooks use module-level variables (e.g., `coldStartHandled`, `handledUrls`) for state that must survive across React effect re-runs (strict mode, HMR)
- Race conditions in async handlers: use cancellation flags (`let cancelled = false`) in useEffect cleanup
- Typecheck: `bunx tsc --noEmit`

## 2026-02-28 - US-001
- Added module-level `const handledUrls = new Set<string>()` to `src/hooks/useDeepLink.ts`
- In focus handler, check `handledUrls.has(url)` before processing; after `await handleDeepLinkUrl(url)`, call `handledUrls.add(url)`
- Files changed: `src/hooks/useDeepLink.ts`
- **Learnings for future iterations:**
  - The existing `processingRef` guards concurrent calls within a single focus event, but `handledUrls` is needed to prevent the same URL being re-processed across multiple focus events
  - Cold-start path intentionally left unchanged (uses `coldStartHandled` flag, not `handledUrls`)
---

## 2026-02-28 - US-002
- Fixed `handleDeleteComment` in `src/pages/MRDetailPage/index.tsx` to capture the comment before optimistic removal
- On API failure, restores via `addComment(toRestore)` (reuses existing `addComment` from `useFileComments`)
- Files changed: `src/pages/MRDetailPage/index.tsx`
- **Learnings for future iterations:**
  - `useFileComments` exposes `addComment` which can be used as a restore mechanism (appends to state)
  - Added `fileComments` and `addComment` to `handleDeleteComment` useCallback deps
---
